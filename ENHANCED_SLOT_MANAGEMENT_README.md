# Enhanced Slot Management System

This document describes the enhanced slot management system for the laundry service application, which provides comprehensive date and time slot management capabilities.

## Features

### üöÄ Core Features

1. **Auto-Generation of 10-Day Dates**
   - Automatically generates dates for the next 10 days
   - Real-time date updates (no past dates)
   - Daily automatic cleanup of past dates

2. **Admin Slot Template Management**
   - Create, edit, and delete slot templates
   - Define custom time slots with labels and ranges
   - Set maximum booking capacity per slot
   - Mark slots as active/inactive

3. **Auto-Generation from Templates**
   - Generate future dates based on existing templates
   - Copy slot configurations from any existing template
   - Automatic conflict detection (skips existing dates)

4. **Enhanced UI/UX**
   - Modern, responsive interface
   - Real-time updates and feedback
   - Expandable template view
   - Visual indicators for auto-generated templates

### üìÖ Date Management

- **Real-time Date Generation**: Always shows the next 10 days from today
- **Automatic Cleanup**: Removes past dates automatically
- **Date Validation**: Prevents creation of templates for past dates
- **Timezone Safe**: Handles timezone differences correctly

### ‚è∞ Slot Management

- **Flexible Time Ranges**: Support for any time range in HH:MM-HH:MM format
- **Custom Labels**: Add descriptive labels for each slot
- **Booking Capacity**: Set maximum bookings per slot (1-100)
- **Active/Inactive Status**: Toggle slots on/off without deletion

### üîÑ Auto-Generation System

- **Template-Based**: Uses existing templates as base for new dates
- **Smart Conflict Resolution**: Skips dates that already have templates
- **Batch Processing**: Generates multiple dates at once
- **Audit Trail**: Tracks which template was used for auto-generation

## API Endpoints

### Slot Template Management

```
POST /api/slots - Create/update slot templates
POST /api/auto-generate-dates - Auto-generate dates from template
GET /api/slot-templates - Get all slot templates
GET /api/slot-template/:date - Get specific template by date
PUT /api/slot-template/:date - Update template for specific date
DELETE /api/slot-template/:date - Delete template for specific date
POST /api/cleanup-past-dates - Clean up past dates
GET /api/next-available-dates - Get available dates for auto-generation
```

### Request Examples

#### Create Slot Template
```json
{
  "dates": ["2025-01-15", "2025-01-16"],
  "slots": [
    {
      "label": "Morning Shift",
      "range": "07:00-09:00",
      "maxBookings": 10,
      "isActive": true
    },
    {
      "label": "Afternoon Shift",
      "range": "14:00-16:00",
      "maxBookings": 15,
      "isActive": true
    }
  ]
}
```

#### Auto-Generate Dates
```json
{
  "templateDate": "2025-01-15",
  "numberOfDays": 10
}
```

## Database Schema

### SlotTemplate Model
```javascript
{
  date: String,           // YYYY-MM-DD format, unique
  slots: [{
    label: String,        // e.g., "Morning Shift"
    range: String,        // e.g., "07:00-09:00"
    maxBookings: Number,  // 1-100, default 10
    isActive: Boolean     // default true
  }],
  isAutoGenerated: Boolean,    // default false
  sourceTemplate: String,      // reference to source template
  createdAt: Date,
  updatedAt: Date
}
```

## Setup Instructions

### 1. Backend Setup

1. **Install Dependencies**
   ```bash
   cd Backend
   npm install
   ```

2. **Set up Environment Variables**
   ```bash
   # .env file
   MONGODB_URI=your_mongodb_connection_string
   ```

3. **Run Database Migrations** (if needed)
   ```bash
   npm run migrate
   ```

### 2. Frontend Setup

1. **Install Dependencies**
   ```bash
   cd Frontend
   npm install
   ```

2. **Start Development Server**
   ```bash
   npm run dev
   ```

### 3. Auto-Generation Setup

1. **Install node-cron**
   ```bash
   cd Backend
   npm install node-cron
   ```

2. **Set up Cron Jobs**
   ```bash
   npm run setup-cron
   ```

3. **Test Auto-Generation**
   ```bash
   npm run auto-generate-dates
   ```

## Usage Guide

### For Administrators

#### Creating Slot Templates

1. Navigate to Admin Dashboard ‚Üí Time Slots Management
2. Select dates from the available 10-day range
3. Add time slots with labels and ranges
4. Set maximum booking capacity for each slot
5. Click "Save Slot Templates"

#### Auto-Generating Dates

1. Click "Auto Generate" button
2. Select a template to use as base
3. Choose number of days to generate (default: 10)
4. Click "Auto Generate" to create templates

#### Managing Existing Templates

1. View all templates in the right sidebar
2. Click expand arrow to see slot details
3. Use action buttons:
   - **Edit**: Modify slot configuration
   - **Copy**: Use for auto-generation
   - **Delete**: Remove template

#### Cleaning Up Past Dates

1. Click "Cleanup Past" button in header
2. Confirm the action
3. Past templates will be automatically removed

### For Washermen

1. Navigate to Washerman Dashboard
2. View available slot templates
3. Enable/disable slots for specific dates
4. Set maximum bookings for enabled slots

## Automation

### Daily Auto-Generation

The system can be configured to automatically generate dates daily:

#### Option 1: Cron Job (Linux/Mac)
```bash
# Add to crontab
0 0 * * * cd /path/to/project/Backend && npm run auto-generate-dates
```

#### Option 2: Windows Task Scheduler
- Create daily task at 12:00 AM
- Run: `node scripts/autoGenerateDates.js`

#### Option 3: PM2 (Production)
```bash
pm2 install pm2-cron
pm2 set pm2-cron:auto-generate-dates "0 0 * * *"
```

### Manual Triggers

- **Immediate Generation**: Use admin interface
- **Script Execution**: `npm run auto-generate-dates`
- **API Call**: POST to `/api/auto-generate-dates`

## Configuration

### Environment Variables

```bash
# Required
MONGODB_URI=mongodb://localhost:27017/laundry-service

# Optional
NODE_ENV=production
PORT=5000
```

### Customization

#### Date Range
Modify `generateNextNDates(10)` in components to change the number of days shown.

#### Time Slots
Default slots can be modified in the frontend components.

#### Auto-Generation Frequency
Change cron schedule in `scripts/autoGenerateDates.js`.

## Troubleshooting

### Common Issues

1. **Dates Not Updating**
   - Check timezone settings
   - Verify date generation logic
   - Clear browser cache

2. **Auto-Generation Fails**
   - Check MongoDB connection
   - Verify template exists
   - Check logs in `Backend/logs/`

3. **Slots Not Saving**
   - Validate slot format (HH:MM-HH:MM)
   - Check admin permissions
   - Verify API endpoints

### Logs

- **Application Logs**: Check server console
- **Auto-Generation Logs**: `Backend/logs/auto-generate.log`
- **Error Logs**: Check browser console and server logs

## Security

- All endpoints require admin authentication
- Input validation on all API endpoints
- SQL injection protection via Mongoose
- XSS protection via input sanitization

## Performance

- Efficient date generation algorithms
- Database indexing on date fields
- Caching for frequently accessed templates
- Batch operations for bulk updates

## Future Enhancements

- [ ] Recurring slot patterns
- [ ] Holiday/special day handling
- [ ] Advanced slot conflict resolution
- [ ] Integration with booking system
- [ ] Analytics and reporting
- [ ] Mobile app support

## Support

For issues or questions:
1. Check this documentation
2. Review error logs
3. Test with minimal configuration
4. Contact development team

---

**Version**: 1.0.0  
**Last Updated**: January 2025  
**Maintainer**: Development Team

